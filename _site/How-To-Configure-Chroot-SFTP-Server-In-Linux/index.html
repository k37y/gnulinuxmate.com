<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"> <title>How to configure chroot SFTP server in Linux &#8211; linuxmate</title> <meta name="description" content="IntroductionSFTP stands for Secure File Transfer Protocol. One of the perfect way to upload and download files. Normal FTP is not that secure to transfer data as it has security vulnerabilities. SFTP doesn’t need any additional package when we have openssh installed in our machine. If we have SSH credentials, they can also act as SFTP but that is not secure way to share with everyone as it provides access to all filesystem files. Some configuration tweaks in the /etc/ssh/ssh_config file can limited this access to specific directory called chroot access which will secure enough to accessible by public. This is exactly what we are going to demonstrate here."> <meta name="keywords" content="sftp, secure ftp, ssh ftp"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:image" content="http://localhost:4000//images/sftp.jpg"> <meta name="twitter:title" content="How to configure chroot SFTP server in Linux"> <meta name="twitter:description" content="IntroductionSFTP stands for Secure File Transfer Protocol. One of the perfect way to upload and download files. Normal FTP is not that secure to transfer data as it has security vulnerabilities. SFTP doesn’t need any additional package when we have openssh installed in our machine. If we have SSH credentials, they can also act as SFTP but that is not secure way to share with everyone as it provides access to all filesystem files. Some configuration tweaks in the /etc/ssh/ssh_config file can limited this access to specific directory called chroot access which will secure enough to accessible by public. This is exactly what we are going to demonstrate here."> <meta name="twitter:site" content="@kevy_vinu"> <meta name="twitter:creator" content="@kevy_vinu"> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="How to configure chroot SFTP server in Linux"> <meta property="og:description" content="IntroductionSFTP stands for Secure File Transfer Protocol. One of the perfect way to upload and download files. Normal FTP is not that secure to transfer data as it has security vulnerabilities. SFTP doesn’t need any additional package when we have openssh installed in our machine. If we have SSH credentials, they can also act as SFTP but that is not secure way to share with everyone as it provides access to all filesystem files. Some configuration tweaks in the /etc/ssh/ssh_config file can limited this access to specific directory called chroot access which will secure enough to accessible by public. This is exactly what we are going to demonstrate here."> <meta property="og:url" content="http://localhost:4000/How-To-Configure-Chroot-SFTP-Server-In-Linux/"> <meta property="og:site_name" content="linuxmate"> <meta property="og:image" content="http://localhost:4000/images/halve.png"> <link rel="canonical" href="http://localhost:4000/How-To-Configure-Chroot-SFTP-Server-In-Linux/"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Feed --> <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="" /> <!-- Favicons --> <link rel="shortcut icon" type="image/png" href="http://localhost:4000/favicon.png" /> <link rel="shortcut icon" href="http://localhost:4000/favicon.ico" /> <!-- CSS --> <link rel="stylesheet" type="text/css" href="http://localhost:4000/assets/css/main.css"> <!-- Left Block Image for Posts --> <style type="text/css"> #posts.inner-post-page .block-left {background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(http://localhost:4000//images/sftp.jpg) no-repeat;background-size: cover;} </style> <!-- Left Block Images for Home and Pages --> <style type="text/css"> #posts .block-left {background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(http://localhost:4000/images/posts.jpg) no-repeat;background-size: cover, cover;} .block-left {background: linear-gradient(rgba(44,45,51,0.9), rgba(44,45,51,0.9)), url(http://localhost:4000/images/home.png) no-repeat;background-size: cover;} </style> </head> <body id="posts" class="inner-post-page"> <div class="block-left"> <div class="content"> <a href="http://localhost:4000" class="logo"><img src="http://localhost:4000/images/halve.png"></a> <div class="post-title-section"> <div class="section-line">Posts <em>/</em></div> <h1 class="section-title">How to configure chroot SFTP server in Linux </h1> <ul class="tags"> <li><a href="http://localhost:4000/tags#sftp">sftp</a></li> <li><a href="http://localhost:4000/tags#secure ftp">secure ftp</a></li> <li><a href="http://localhost:4000/tags#ssh ftp">ssh ftp</a></li> </ul> <div class="section-line reverse"><a href="http://localhost:4000/posts">Back to posts</a> <em>/</em></div> </div> </div> </div> <div class="block-right"> <div class="share-buttons"> <a href="https://twitter.com/intent/tweet?text=http://localhost:4000/How-To-Configure-Chroot-SFTP-Server-In-Linux/" class="btn btn_twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a> <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/How-To-Configure-Chroot-SFTP-Server-In-Linux/" class="btn btn_facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a> </div> <a href="../posts.html" title="posts" class="posts-menu-icon"></a> <a href="/portfolio" title="portfolio" class="projects-menu-icon"> <span></span> </a> <div class="inner-post content"> <div class="date-highlight">23 Jan 2018</div> <h2 id="introduction">Introduction</h2> <p>SFTP stands for Secure File Transfer Protocol. One of the perfect way to upload and download files. Normal FTP is not that secure to transfer data as it has security vulnerabilities. SFTP doesn’t need any additional package when we have openssh installed in our machine. If we have SSH credentials, they can also act as SFTP but that is not secure way to share with everyone as it provides access to all filesystem files. Some configuration tweaks in the <code class="highlighter-rouge">/etc/ssh/ssh_config</code> file can limited this access to specific directory called chroot access which will secure enough to accessible by public. This is exactly what we are going to demonstrate here.</p> <h2 id="how-to-do">How-To-Do</h2> <h3 id="create-new-user">1. Create new user</h3> <p>First of all, create a new user called <strong>linuxmate</strong> to provide people credentials who need access to the files:</p> <div class="highlighter-rouge"><pre class="highlight"><code>sudo useradd linuxmate -s /sbin/nologin
sudo passwd linuxmate
</code></pre></div> <h3 id="add-entries-to-sshdconfig-file">2. Add entries to <code class="highlighter-rouge">sshd_config</code> file</h3> <p>Open-up <code class="highlighter-rouge">/etc/ssh/sshd_config</code> (careful with the file name, the same directory contains file named <code class="highlighter-rouge">ssh_config</code>) file and uncomment <code class="highlighter-rouge">Subsystem sftp /usr/lib/openssh/sftp-server</code> line then add new line:</p> <div class="highlighter-rouge"><pre class="highlight"><code><span class="c">#Subsystem sftp /usr/lib/openssh/sftp-server  </span>
Subsystem sftp  internal-sftp
</code></pre></div> <p>Next we make provision access to a specific user which we created above:</p> <div class="highlighter-rouge"><pre class="highlight"><code>Match User linuxmate  
ChrootDirectory /sftpusers/chroot/  
ForceCommand internal-sftp  
AllowTcpForwarding no  
X11Forwarding no
</code></pre></div> <p><code class="highlighter-rouge">Match User linuxmate</code> - Only provide access to linuxmate user, you can add group name with <code class="highlighter-rouge">Group</code> instead of <code class="highlighter-rouge">User</code> in the line.<br /> <code class="highlighter-rouge">ChrootDirectory /sftpusers/chroot/</code> - It will be the sftp chroot directory.<br /> <code class="highlighter-rouge">AllowTcpForwarding no</code> - It will not allow ssh jump connection. People will use the machine for SSH jump which can’t be entertained as security will be compromised unless you are explicitly required.<br /> <code class="highlighter-rouge">X11Forwarding no</code> - Restrict access to GUI applications.</p> <p>Restart sshd service after successful configuration.</p> <h3 id="sftp-client-access">SFTP client access</h3> <p>SFTP browser access can be achieved by adding browser extension or you are able to use FileZilla instead.</p> <p><img src="/images/sftp-client.png" alt="sftp-client.png" /></p> <p><code class="highlighter-rouge">address</code> - IP address of the server<br /> <code class="highlighter-rouge">username</code> - linuxmate<br /> <code class="highlighter-rouge">password</code> - <em>whatever you have entered</em><br /> <code class="highlighter-rouge">port</code> - 22</p> <p>For commnad-line users:</p> <p><code class="highlighter-rouge"> sftp linuxmate@172.168.1.199</code></p> <html> <head> <link rel="stylesheet" type="text/css" href="/assets/css/asciinema-player.css" /> </head> <body> <asciinema-player src="/cast/sftp.cast" speed="2" theme="asciinema" poster="data:text/plain,\e[1;37mHow to \e[1;33mconnect \e[1;37mto sftp server" cols="100" rows="22"></asciinema-player> <script src="/assets/js/asciinema-player.js"></script> </body> </html> <h3 id="conclusion">Conclusion</h3> <p>I believe this tutorial is complete enough to make your own SFTP server. If you have business rule such as number of files to share with public or private, SFTP will be a much appropriate way of choice as it is encrypted and simple to configure from scratch compare to conventional FTP server. When we start deploy something, it is normal to rise doubts even if the documentation gives enough information. In that case, please don’t hesitate to ask in the comment box below.</p> <br> <a href="https://twitter.com/intent/tweet?text=http://localhost:4000/How-To-Configure-Chroot-SFTP-Server-In-Linux/" class="btn btn_twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a> <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/How-To-Configure-Chroot-SFTP-Server-In-Linux/" class="btn btn_facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a> <nav class="pagination"> <a href="http://localhost:4000/Iptables-A-Simple-Use-Case/" class="pagination_pager" title="Iptables - A simple use case ">previous</a> <a href="http://localhost:4000/Oracle-Database-Appliance-Deployment/" class="pagination_pager" title="Oracle Database Appliance Deployment ">next</a> </nav> <br> <br> <div class="comments"> <div id="disqus_thread"></div> <script type="text/javascript"> var disqus_shortname = 'linuxmate-ml'; /* ensure that pages with query string get the same discussion */ var url_parts = window.location.href.split("?"); var disqus_url = url_parts[0]; (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); </script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> </div> </div> </div> <!-- JS --> <script src="http://localhost:4000/assets/js/main.min.js"></script> </body> </html>
